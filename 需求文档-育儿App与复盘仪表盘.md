## 育儿App & 复盘仪表盘 产品需求文档（PRD）

### 文档元信息
- **版本**: v1.1-MVP
- **状态**: Updated（已更新）
- **负责人**: 产品经理 / iOS负责人 / 后端负责人 / AI负责人
- **创建日期**: 2025-12-02
- **更新日期**: 2025-12-03
- **更新内容**: 增强快捷记录功能（喝奶、辅食、睡眠、换尿布）详细交互和数据模型

---

## 1. 产品概述
- **产品定位**: 面向0-3岁婴幼儿家长的科学育儿管理App，结合儿保报告解析、医学量表评测与个性化日程管理。
- **核心价值**: 通过AI与医学指南，将育儿数据（喂养/睡眠/发育）结构化，并生成可执行的每日计划与周期复盘报告。
- **主要人群**: 一线及新一线城市新生代父母，重视科学育儿与数据可视化。
- **差异化**: 免费AI儿保报告分析 + 医学量表发育评测（VIP）+ 智能日程推荐 + 周/月复盘仪表盘。

---

## 2. 需求范围
- **MVP范围**:
  - 宝宝档案管理（基础信息、成长曲线）
  - 报告上传与AI分析（OCR+规则解析，基础建议）
  - 智能日程规划（喂养/小睡/运动/辅食建议）
  - 复盘仪表盘（周/月概览、核心指标看板、基础洞察、PDF导出）
- **进阶范围**:
  - 发育评测系统（ASQ-3 / DDST-II / Gesell；VIP功能）
  - 高级AI洞察（模式识别、异常检测、关联分析、自然语言总结）
  - B端合作/专家咨询/硬件接入（后续版本）

---

## 3. 用户与角色
- **家长用户（普通）**: 宝宝数据录入、报告上传、查看AI分析、查看复盘仪表盘基础数据。
- **家长用户（VIP）**: 开启发育评测、查看高级图表与历史对比、使用高级洞察与导出模板。
- **管理员**: 审核内容、管理量表与题库、运营配置。
- **（可选）医务人员/B端**: 查看授权数据与趋势报告（后续版本）。

---

## 4. 业务流程概览
1. 宝宝信息录入 → 成长曲线初始化 → 后续数据驱动
2. 儿保报告上传 → OCR与NLP解析 → AI分析结论 → 更新日程建议
3. 发育评测（VIP）→ 月龄匹配题库 → 评分与报告 → 训练建议
4. 智能日程规划 → 当日执行打卡 → 数据事件沉淀
5. 复盘仪表盘 → 周/月聚合统计 → 智能洞察 → PDF导出/分享

---

## 5. 功能需求清单
### 5.1 宝宝档案管理
- **字段**: 昵称、出生日期、性别、出生胎龄（周+天，选填）、身高、体重、头围（可选）。
- **校验**: 出生日期不可未来、胎龄天数0-6、身高体重范围合理、单位统一。
- **胎龄功能**: 
  - 37周前分娩自动标记为早产儿
  - 提供矫正月龄计算（40周 - 实际胎龄）
  - 成长曲线使用瞫正月龄进行比对
  - 显示实际月龄和矫正月龄两个值
- **能力**: 多宝宝档案、成长曲线（WHO/CDC百分位可切换）、历史记录、编辑/删除功能。

### 5.2 报告上传与AI分析（免费）
- **文件类型**: 图片（JPG/PNG/HEIC）、PDF。
- **识别**: OCR提取关键指标（身高/体重/头围/血常规等）。
- **解析**: NLP实体抽取与结构化，阈值规则与参考范围比对。
- **输出**: 指标解读、异常项预警、基础喂养/营养建议、就医提示（边界声明）。
- **联动**: 同步更新智能日程推荐权重与提醒频次。

### 5.3 发育评测系统（VIP）
- **量表**: ASQ-3 / DDST-II / Gesell（分能区：大运动/精细/语言/社交/认知）。
- **逻辑**: 月龄适配题目、评分规则、发育商（DQ）计算、雷达图展示。
- **报告**: 能区得分、训练建议、历史对比与趋势。

### 5.4 智能日程规划
- **输入**: 月龄、体重、喂养方式（母乳/混合/奶粉）、辅食阶段、睡眠数据、报告指标。
- **标准**: 参考《卫健委2025喂养评估指南（0-3岁）》与通用睡眠窗口。
- **输出**: 喝奶时间与奶量、辅食种类与频次、运动时间与内容、小睡时间窗口、交互游戏建议。
- **交互**: 手动微调、打卡记录、推送提醒（APNs）。

### 5.5 快捷记录功能（重点增强）
#### 5.5.1 喝奶记录
- **记录时间**: 支持选择日期和时间，默认当前时间
- **喂养方式**:
  - **亲喂**: 支持计时器模式或手动输入开始/结束时间
  - **瓶装**: 选择母乳/奶粉，输入毫升数
- **奶量输入**:
  - 滑块调节（30-300ml，10ml步长）
  - 快捷选择：60/90/120/150/180/210/240/270ml（横向滚动）
  - 圆角按钮，选中粉色高亮
- **备注**: 可选文本输入
- **数据字段**: `recordTime`, `feedingMethod`, `milkType`, `amount`, `notes`

#### 5.5.2 辅食记录
- **记录时间**: 支持选择日期和时间，默认当前时间
- **辅食选择**: 多选模式，分类展示
  - **谷物类**: 米粉、米糊、燕麦、面条等
  - **蔬菜类**: 南瓜、胡萝卜、土豆、西兰花等
  - **水果类**: 苹果、香蕉、龙果等
  - **蛋白质类**: 鸡蛋、鱼肉、豆腐等
- **自定义输入**: 支持输入其他辅食名称
- **已选展示**: 顶部显示已选辅食，可删除
- **备注**: 可选文本输入
- **数据字段**: `recordTime`, `foods` (Array), `customFood`, `notes`

#### 5.5.3 睡眠记录
- **记录方式**:
  - **计时器模式**: 开始/停止按钮自动计时
  - **手动输入**: 分别选择开始和结束时间
- **时长显示**: 实时显示睡眠时长
- **备注**: 可选文本输入（如睡眠质量、夜醒次数）
- **数据字段**: `startTime`, `endTime`, `duration`, `notes`

#### 5.5.4 换尿布记录
- **记录时间**: 支持选择日期和时间，默认当前时间
- **类型选择**: 尿尿/便便/尿尿+便便
- **尿尿信息** (当选择尿尿或尿尿+便便时):
  - **颜色**: 透明/淡黄/黄色/深黄/橙色/红色/棕色
  - **视觉区分**: 蓝色主题按钮，区别于便便的粉色
  - **健康提示**: 异常颜色自动显示警告（深黄/橙/红/棕）
- **便便信息** (当选择便便或尿尿+便便时):
  - **状态**: 正常/较干/较稀
  - **颜色**: 黄色/金黄/棕色/绿色/灰白/黑色/红色
  - **视觉区分**: 粉色主题按钮
  - **健康提示**: 异常颜色自动显示警告
- **备注**: 可选文本输入
- **数据字段**: `recordTime`, `type`, `peeColor`, `poopStatus`, `poopColor`, `notes`

#### 5.5.5 快捷记录通用设计
- **时间选择器**: 统一放置在弹窗顶部，使用 `.compact` 风格
- **横向滚动**: 选项较多时支持横向滚动，隐藏滚动条
- **按钮尺寸**: 较大的点击区域，易于操作
- **视觉反馈**: 选中状态明显区分（粉色高亮/蓝色高亮）
- **分隔线**: 移除不必要的分隔线，保持简洁

### 5.6 复盘仪表盘（重设计）
- **时间维度**: 周报、月报、季度（MVP含周/月）。
- **健康看板**: 生长曲线（体重/身高/头围）、增速监控、异常预警。
- **喂养分析**: 奶量趋势、辅食接受度热力图、过敏食物标记、营养素估算。
- **睡眠质量**: 总时长、夜醒次数、入睡规律性、睡眠周期可视化。
- **发育进度**: 能区得分曲线、同龄对比（匿名汇总，后续）、训练任务推荐。
- **执行效率**: 日程完成率日历热力图、任务完成度、连续打卡勋章、家庭成员贡献度（多账号）。
- **智能洞察**: 模式识别（最佳小睡时段、厌奶期迹象）、异常检测（3-sigma）、关联分析（食材与便便变化）。
- **生成内容**: 周/月自然语言总结、PDF导出（基础模板）、分享卡片。
- **空状态**: 数据不足引导（至少7天数据生成周报）。

### 5.7 会员与支付
- **权益**: 发育评测、历史对比、进阶图表、专家解读模板。
- **策略**: 月度/年度订阅、试用期、促销权益。

### 5.8 通知与分享
- **通知**: 日程提醒、周报生成提醒、异常指标预警。
- **分享**: 图表与报告卡片生成、社交平台分享（隐私遮蔽）。

---

## 6. 数据与模型
### 6.1 关键数据实体
- **Baby**: 档案、出生信息、胎龄信息（gestationalWeeks/gestationalDays）、成长指标。
- **Report**: 原始报告文件、结构化指标、AI分析结论。
- **Assessment**: 量表答题记录、得分、能区报告。
- **Schedule**: 推荐日程、打卡记录、调整历史。
- **MilkRecord**: 喝奶记录 (`recordTime`, `feedingMethod`, `milkType`, `amount`, `startTime`, `endTime`, `notes`)。
- **FoodRecord**: 辅食记录 (`recordTime`, `foods[]`, `customFood`, `notes`)。
- **SleepRecord**: 睡眠记录 (`startTime`, `endTime`, `duration`, `notes`)。
- **DiaperRecord**: 换尿布记录 (`recordTime`, `type`, `peeColor`, `poopStatus`, `poopColor`, `notes`)。
- **Event**: 原始行为事件（MILK/FOOD/NAP/WAKE/DIAPER等）。
- **DailySnapshot**: 日度聚合指标（奶量、次数、睡眠、尿布次数、完成率等）。
- **WeeklyReport / MonthlyReport**: 周/月复盘数据与AI摘要、导出链接。

### 6.2 数据约束
- 时间统一UTC+8，精度至分钟；
- 单位标准化（体重kg/奶量ml/时长min）；
- 异常值清洗与缺失补全策略；
- 敏感数据加密存储与访问审计。

---

## 7. 接口概要（后端）
- `GET /api/dashboard/overview?babyId&period=week|month`
  - 返回：核心指标概览（完成率、奶量、睡眠、发育得分摘要）。
- `GET /api/dashboard/growth-curve?babyId&months=N`
  - 返回：成长曲线点位与百分位参考线。
- `GET /api/dashboard/weekly-report?babyId&weekStart=yyyy-MM-dd`
  - 返回：周度复盘数据与AI摘要。
- `POST /api/dashboard/insights/generate?babyId`
  - 返回：洞察列表（类型/结论/建议/证据）。
- `GET /api/dashboard/export/pdf?babyId&period`
  - 返回：PDF二进制或下载链接（根据实现）。

（其他服务接口：用户、宝宝、文件、评测、日程、支付；此处不展开）

---

## 8. 非功能需求
- **性能**: 
  - 仪表盘首屏TTP ≤ 1200ms（缓存+增量聚合）；
  - 报告导出≤ 5s（异步生成+队列通知）。
- **稳定性**: 99.9%月度可用性；关键链路降级与重试。
- **安全**: JWT鉴权、TLS 1.3、AES-256敏感数据加密；权限隔离与最小化授权。
- **隐私与合规**: PIPL/COPPA/GDPR对齐；匿名化/脱敏；用户协议边界声明。
- **可观测性**: 指标、日志、链路追踪；异常报警；操作审计。

---

## 9. 指标与埋点
- **核心业务指标**: 周/月留存、付费转化率、任务完成率、奶量均值与波动、总睡眠时长与夜醒次数、评测覆盖率。
- **埋点事件**: 打卡完成、报告上传成功/失败、评测开始/完成、导出报告、分享点击、通知点击。
- **分析维度**: 月龄、喂养方式、VIP与否、活跃度分层。

---

## 10. 风险与边界
- **技术风险**: OCR/NLP识别误差；数据质量不稳定；端云一致性。
- **合规风险**: 医疗建议边界（不替代诊断）；隐私与数据跨境。
- **商业风险**: 付费意愿不足；获客成本高；竞品快速跟进。
- **医疗风险**: 建议误导与责任；专业审核与免责声明。
- **边界声明**: 本产品提供参考性指导，不替代医生诊断。

---

## 11. 里程碑与验收
- **Phase 1（2周）**: 聚合与统计API、仪表盘基础UI、周/月概览；
  - 验收：概览加载≤1.2s；周报生成稳定；核心图表正确。
- **Phase 2（2周）**: 图表完善（热力图/雷达图）、AI基础洞察、规则引擎；
  - 验收：洞察准确率达到预设阈值；异常检测可控。
- **Phase 3（1周）**: PDF导出、分享能力、性能优化与回归；
  - 验收：导出成功率≥99%；分享卡片合规与清晰。

---

## 12. 附录
- 医学量表：ASQ-3 / DDST-II / Gesell（来源需合规授权）。
- 指南参考：卫健委2025喂养评估指南（0-3岁）。
- 术语约定：DQ（Developmental Quotient）= 发育商；Percentile = 百分位。
